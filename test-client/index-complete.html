<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eclair Complete Demo - Firebase + API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            color: #666;
            font-size: 1rem;
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .button {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .button-google {
            background: white;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .button-google:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .button-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .button-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .button-secondary:hover {
            background: #e0e0e0;
        }

        .button-danger {
            background: #ef4444;
            color: white;
        }

        .button-danger:hover {
            background: #dc2626;
        }

        .status {
            padding: 16px;
            border-radius: 12px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }

        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }

        .status-info {
            background: #dbeafe;
            color: #1e40af;
            border: 2px solid #3b82f6;
        }

        .user-card {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            margin: 20px 0;
        }

        .user-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 4px solid #667eea;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 700;
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 5px;
        }

        .user-email {
            color: #666;
            font-size: 0.95rem;
        }

        .hidden {
            display: none;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        input[type="text"],
        input[type="url"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s;
            font-family: inherit;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            min-height: 120px;
            resize: vertical;
            margin-bottom: 10px;
        }

        .test-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }

        .test-box h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1rem;
        }

        .workspace-list,
        .result-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .workspace-item,
        .result-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .workspace-item:hover,
        .result-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
        }

        .item-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .button-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            text-align: center;
        }

        .card-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .card-desc {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .response-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 15px;
        }

        .success-indicator {
            display: inline-block;
            padding: 6px 12px;
            background: #10b981;
            color: white;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-left: 10px;
        }

        .error-indicator {
            display: inline-block;
            padding: 6px 12px;
            background: #ef4444;
            color: white;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Eclair Complete Demo</h1>
            <p class="subtitle">Full Stack Test: Google Sign-In ‚Üí Firebase Auth ‚Üí API Calls</p>
        </div>

        <!-- Step 1: Sign In -->
        <div class="section" id="signInSection">
            <h2>üîê Step 1: Sign In with Google</h2>
            <p style="color: #666; margin-bottom: 20px;">First, sign in with your Google account to get authenticated</p>
            
            <button class="button button-google" onclick="signInWithGoogle()">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Sign in with Google
            </button>

            <div id="signInStatus"></div>
        </div>

        <!-- Step 2: User Profile (after sign-in) -->
        <div class="section hidden" id="profileSection">
            <h2>‚úÖ Signed In Successfully!</h2>
            <div class="user-card">
                <img id="userAvatar" class="user-avatar" src="" alt="Avatar">
                <div class="user-info">
                    <div class="user-name" id="userName"></div>
                    <div class="user-email" id="userEmail"></div>
                </div>
                <button class="button button-secondary" onclick="signOut()">Sign Out</button>
            </div>
        </div>

        <!-- Step 3: Custom Input Test -->
        <div class="section hidden" id="customTestSection">
            <h2>‚úèÔ∏è Step 2: Test API Endpoints</h2>
            <p style="color: #666; margin-bottom: 20px;">Test all endpoints with your own inputs</p>

            <!-- AI Chat Fast Test -->
            <div class="test-box">
                <h3>üí¨ AI Chat (Fast - Llama 3.3 70B)</h3>
                <input type="text" id="chatFastInput" class="form-input" placeholder="Enter your message..." value="What is quantum computing?">
                <button class="button button-primary button-small" onclick="testChatFast()">Send</button>
            </div>

            <!-- AI Chat Advanced Test -->
            <div class="test-box">
                <h3>üß† AI Chat (Advanced - DeepSeek with Reasoning)</h3>
                <input type="text" id="chatAdvancedInput" class="form-input" placeholder="Enter complex query..." value="Explain the theory of relativity">
                <button class="button button-primary button-small" onclick="testChatAdvanced()">Send</button>
            </div>

            <!-- Generate Note Test -->
            <div class="test-box">
                <h3>üìù Generate Note</h3>
                <input type="text" id="generateNoteInput" class="form-input" placeholder="Enter topic..." value="Machine learning basics">
                <button class="button button-primary button-small" onclick="testGenerateNote()">Generate</button>
            </div>

            <!-- Summarize Test -->
            <div class="test-box">
                <h3>üìä Summarize Text</h3>
                <textarea id="summarizeInput" class="form-textarea" placeholder="Paste text to summarize...">Artificial intelligence (AI) is intelligence demonstrated by machines, in contrast to the natural intelligence displayed by humans and animals. Leading AI textbooks define the field as the study of "intelligent agents": any device that perceives its environment and takes actions that maximize its chance of successfully achieving its goals.</textarea>
                <button class="button button-primary button-small" onclick="testSummarize()">Summarize</button>
            </div>

            <!-- Web Summary Test -->
            <div class="test-box">
                <h3>üåê Web Page Summary</h3>
                <input type="url" id="webUrlInput" class="form-input" placeholder="Enter web URL..." value="https://en.wikipedia.org/wiki/Artificial_intelligence">
                <button class="button button-primary button-small" onclick="testWebSummary()">Summarize</button>
            </div>

            <!-- YouTube Summary Test -->
            <div class="test-box">
                <h3>üé• YouTube Video Summary</h3>
                <input type="text" id="youtubeUrlInput" class="form-input" placeholder="Enter YouTube URL..." value="https://www.youtube.com/watch?v=dQw4w9WgXcQ">
                <select id="youtubeType" class="form-input">
                    <option value="concise">Concise (2-3 sentences)</option>
                    <option value="bullet">Bullet Points</option>
                    <option value="detailed">Detailed</option>
                </select>
                <button class="button button-primary button-small" onclick="testYouTubeSummary()">Summarize</button>
            </div>

            <!-- Create Workspace Test -->
            <div class="test-box">
                <h3>üìÅ Create Workspace</h3>
                <input type="text" id="workspaceNameInput" class="form-input" placeholder="Workspace name..." value="My Test Workspace">
                <button class="button button-primary button-small" onclick="testCreateWorkspace()">Create</button>
            </div>

            <!-- List Workspaces Test -->
            <div class="test-box">
                <h3>üìã List All Workspaces</h3>
                <button class="button button-primary button-small" onclick="testGetWorkspaces()">Get Workspaces</button>
            </div>
        </div>

        <!-- Step 4: Quick Tests -->
        <div class="section hidden" id="apiTestsSection" style="display: none;">
            <h2>üß™ Step 3: Quick Test All Endpoints</h2>
            <p style="color: #666; margin-bottom: 20px;">Run pre-configured tests on all endpoints</p>

            <div class="grid">
                <!-- AI Chat Test -->
                <div class="card">
                    <div class="card-icon">ü§ñ</div>
                    <div class="card-title">AI Chat</div>
                    <div class="card-desc">Test streaming chat</div>
                    <button class="button button-primary button-small" onclick="testAIChat()">Test</button>
                </div>

                <!-- Generate Note Test -->
                <div class="card">
                    <div class="card-icon">üìù</div>
                    <div class="card-title">Generate Note</div>
                    <div class="card-desc">Test note generation</div>
                    <button class="button button-primary button-small" onclick="testGenerateNoteOld()">Test</button>
                </div>

                <!-- Summarize Test -->
                <div class="card">
                    <div class="card-icon">üìä</div>
                    <div class="card-title">Summarize Text</div>
                    <div class="card-desc">Test summarization</div>
                    <button class="button button-primary button-small" onclick="testSummarizeOld()">Test</button>
                </div>

                <!-- Create Workspace Test -->
                <div class="card">
                    <div class="card-icon">üìÅ</div>
                    <div class="card-title">Create Workspace</div>
                    <div class="card-desc">Test Firebase auth</div>
                    <button class="button button-primary button-small" onclick="testCreateWorkspaceOld()">Test</button>
                </div>

                <!-- Get Workspaces Test -->
                <div class="card">
                    <div class="card-icon">üìã</div>
                    <div class="card-title">List Workspaces</div>
                    <div class="card-desc">Get all workspaces</div>
                    <button class="button button-primary button-small" onclick="testGetWorkspacesOld()">Test</button>
                </div>

                <!-- Web Summary Test -->
                <div class="card">
                    <div class="card-icon">üåê</div>
                    <div class="card-title">Web Summary</div>
                    <div class="card-desc">Summarize web page</div>
                    <button class="button button-primary button-small" onclick="testWebSummaryOld()">Test</button>
                </div>

                <!-- YouTube Summary Test -->
                <div class="card">
                    <div class="card-icon">üé•</div>
                    <div class="card-title">YouTube Summary</div>
                    <div class="card-desc">Summarize YouTube video</div>
                    <button class="button button-primary button-small" onclick="testYouTubeSummaryOld()">Test</button>
                </div>
            </div>
        </div>

        <!-- Step 4: Results -->
        <div class="section hidden" id="resultsSection">
            <h2>üìä API Test Results</h2>
            <div id="resultsList"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut as firebaseSignOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAQP67YF1CfWIqN3Q0MwLzsF6bRznGfuJc",
            authDomain: "eclair-e2b3e.firebaseapp.com",
            projectId: "eclair-e2b3e",
            storageBucket: "eclair-e2b3e.firebasestorage.app",
            messagingSenderId: "737073613486",
            appId: "1:737073613486:web:d54c84eb65c56a86ae3b3f",
            measurementId: "G-MBRVMFZC3Y"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        const API_BASE = 'https://eclair-b7zo.vercel.app';

        let currentUser = null;
        let firebaseToken = null;

        // Sign In
        window.signInWithGoogle = async function() {
            const statusDiv = document.getElementById('signInStatus');
            try {
                statusDiv.innerHTML = '<div class="status status-info">‚è≥ Opening Google sign-in...</div>';
                const result = await signInWithPopup(auth, provider);
                statusDiv.innerHTML = '<div class="status status-success">‚úÖ Signed in successfully!</div>';
            } catch (error) {
                statusDiv.innerHTML = `<div class="status status-error">‚ùå Error: ${error.message}</div>`;
            }
        };

        // Sign Out
        window.signOut = async function() {
            try {
                await firebaseSignOut(auth);
                document.getElementById('resultsSection').classList.add('hidden');
                document.getElementById('resultsList').innerHTML = '';
            } catch (error) {
                console.error('Sign-out error:', error);
            }
        };

        // Auth State Listener
        onAuthStateChanged(auth, async (user) => {
            const signInSection = document.getElementById('signInSection');
            const profileSection = document.getElementById('profileSection');
            const apiTestsSection = document.getElementById('apiTestsSection');

            if (user) {
                currentUser = user;
                firebaseToken = await user.getIdToken();

                // Update UI
                document.getElementById('userName').textContent = user.displayName;
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('userAvatar').src = user.photoURL;

                // Show sections
                signInSection.classList.add('hidden');
                profileSection.classList.remove('hidden');
                customTestSection.classList.remove('hidden');
                apiTestsSection.classList.remove('hidden');
            } else {
                currentUser = null;
                firebaseToken = null;

                signInSection.classList.remove('hidden');
                profileSection.classList.add('hidden');
                customTestSection.classList.add('hidden');
                apiTestsSection.classList.add('hidden');
            }
        });

        // Test Functions
        function addResult(title, success, data) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsList = document.getElementById('resultsList');
            
            resultsSection.classList.remove('hidden');

            const indicator = success 
                ? '<span class="success-indicator">‚úÖ SUCCESS</span>'
                : '<span class="error-indicator">‚ùå FAILED</span>';

            const resultHTML = `
                <div class="result-item">
                    <div class="item-header">
                        <div class="item-title">${title}${indicator}</div>
                    </div>
                    <div class="response-box">${JSON.stringify(data, null, 2)}</div>
                </div>
            `;

            resultsList.insertAdjacentHTML('afterbegin', resultHTML);
        }

        window.testAIChat = async function() {
            addResult('ü§ñ AI Chat Test', true, { status: 'Starting...' });

            try {
                const response = await fetch(`${API_BASE}/api/ai/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: 'Say "Hello from Eclair!" in one sentence.',
                        temperature: 0.7
                    })
                });

                let fullResponse = '';
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.content) {
                                    fullResponse += data.content;
                                }
                                if (data.finished) {
                                    addResult('ü§ñ AI Chat Test', true, {
                                        endpoint: 'POST /api/ai/chat',
                                        authentication: 'None (public endpoint)',
                                        response: fullResponse,
                                        status: 'Success - AI streaming working!'
                                    });
                                    return;
                                }
                            } catch (e) {}
                        }
                    }
                }
            } catch (error) {
                addResult('ü§ñ AI Chat Test', false, { error: error.message });
            }
        };

        window.testGenerateNote = async function() {
            addResult('üìù Generate Note Test', true, { status: 'Starting...' });

            try {
                const response = await fetch(`${API_BASE}/api/ai/generate-note`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: 'Write a note about the benefits of note-taking',
                        action: 'generate',
                        temperature: 0.7
                    })
                });

                let fullResponse = '';
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.content) {
                                    fullResponse += data.content;
                                }
                                if (data.finished) {
                                    addResult('üìù Generate Note Test', true, {
                                        endpoint: 'POST /api/ai/generate-note',
                                        authentication: 'None (public endpoint)',
                                        action: 'generate',
                                        response: fullResponse,
                                        status: 'Success - Note generation working!'
                                    });
                                    return;
                                }
                            } catch (e) {}
                        }
                    }
                }
            } catch (error) {
                addResult('üìù Generate Note Test', false, { error: error.message });
            }
        };

        window.testSummarize = async function() {
            addResult('üìä Summarize Test', true, { status: 'Starting...' });

            try {
                const response = await fetch(`${API_BASE}/api/ai/summarize`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content: 'Artificial intelligence is revolutionizing technology across multiple domains. Machine learning enables computers to learn from data without explicit programming. Neural networks, inspired by the human brain, process information through interconnected layers. Deep learning uses multiple layers to extract high-level features from raw data. Natural language processing allows computers to understand and generate human language. Computer vision enables machines to interpret visual information from the world.',
                        summary_type: 'general'
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    addResult('üìä Summarize Test', true, {
                        endpoint: 'POST /api/ai/summarize',
                        authentication: 'None (public endpoint)',
                        summary: data.summary,
                        original_length: data.original_length,
                        summary_type: data.summary_type,
                        status: 'Success - Summarization working!'
                    });
                } else {
                    addResult('üìä Summarize Test', false, data);
                }
            } catch (error) {
                addResult('üìä Summarize Test', false, { error: error.message });
            }
        };

        window.testWebSummary = async function() {
            addResult('üåê Web Summary Test', true, { status: 'Starting...' });

            try {
                const response = await fetch(`${API_BASE}/api/web-summary/summarize`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        url: 'https://en.wikipedia.org/wiki/Artificial_intelligence'
                    })
                });

                let fullResponse = '';
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.content) {
                                    fullResponse += data.content;
                                }
                                if (data.finished) {
                                    addResult('üåê Web Summary Test', true, {
                                        endpoint: 'POST /api/web-summary/summarize',
                                        authentication: 'None (public endpoint)',
                                        url: 'https://en.wikipedia.org/wiki/Artificial_intelligence',
                                        summary: fullResponse,
                                        status: 'Success - Web summarization working!'
                                    });
                                    return;
                                }
                            } catch (e) {}
                        }
                    }
                }
            } catch (error) {
                addResult('üåê Web Summary Test', false, { error: error.message });
            }
        };

        window.testYouTubeSummary = async function() {
            addResult('üé• YouTube Summary Test', true, { status: 'Starting...' });

            try {
                const response = await fetch(`${API_BASE}/api/youtube-summary/summarize`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        videoUrl: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                        summaryType: 'concise'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    addResult('üé• YouTube Summary Test', true, {
                        endpoint: 'POST /api/youtube-summary/summarize',
                        authentication: 'None (public endpoint)',
                        videoId: data.videoId,
                        summaryType: data.summaryType,
                        summary: data.summary,
                        wordCount: data.transcriptWordCount,
                        duration: Math.round(data.videoDuration / 60) + ' minutes',
                        status: 'Success - YouTube transcription working!'
                    });
                } else {
                    addResult('üé• YouTube Summary Test', false, data);
                }
            } catch (error) {
                addResult('üé• YouTube Summary Test', false, { error: error.message });
            }
        };

        // Custom test functions with user input
        // New test functions using user input
        window.testChatFast = async function() {
            const prompt = document.getElementById('chatFastInput').value.trim();
            if (!prompt) {
                addResult('üí¨ AI Chat Fast', false, { error: 'Please enter a message' });
                return;
            }

            addResult('üí¨ AI Chat Fast (Llama 3.3 70B)', true, { status: 'Sending...' });

            try {
                const response = await fetch(`${API_BASE}/api/ai/chat-fast`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt })
                });

                let fullResponse = '';
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.content) fullResponse += data.content;
                                if (data.finished) {
                                    addResult('üí¨ AI Chat Fast (Llama 3.3 70B)', true, {
                                        model: 'meta/llama-3.3-70b-instruct',
                                        prompt,
                                        response: fullResponse,
                                        note: 'Fast model with concise responses'
                                    });
                                    return;
                                }
                            } catch (e) {}
                        }
                    }
                }
            } catch (error) {
                addResult('üí¨ AI Chat Fast', false, { error: error.message });
            }
        };

        window.testChatAdvanced = async function() {
            const prompt = document.getElementById('chatAdvancedInput').value.trim();
            if (!prompt) {
                addResult('üß† AI Chat Advanced', false, { error: 'Please enter a message' });
                return;
            }

            addResult('üß† AI Chat Advanced (DeepSeek)', true, { status: 'Thinking...' });

            try {
                const response = await fetch(`${API_BASE}/api/ai/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt })
                });

                let fullResponse = '';
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.content) fullResponse += data.content;
                                if (data.finished) {
                                    addResult('üß† AI Chat Advanced (DeepSeek)', true, {
                                        model: 'deepseek-ai/deepseek-r1-distill-qwen-14b',
                                        prompt,
                                        response: data.fullResponse || fullResponse,
                                        note: 'Advanced model with reasoning (think blocks removed)'
                                    });
                                    return;
                                }
                            } catch (e) {}
                        }
                    }
                }
            } catch (error) {
                addResult('üß† AI Chat Advanced', false, { error: error.message });
            }
        };

        window.testGenerateNote = async function() {
            const prompt = document.getElementById('generateNoteInput').value.trim();
            if (!prompt) {
                addResult('üìù Generate Note', false, { error: 'Please enter a topic' });
                return;
            }

            addResult('üìù Generate Note', true, { status: 'Generating...' });

            try {
                const response = await fetch(`${API_BASE}/api/ai/generate-note`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: `${prompt}. Reply concisely.`, action: 'generate' })
                });

                let fullResponse = '';
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.content) fullResponse += data.content;
                                if (data.finished) {
                                    addResult('üìù Generate Note', true, {
                                        topic: prompt,
                                        content: data.fullResponse || fullResponse,
                                        status: 'Note generated successfully'
                                    });
                                    return;
                                }
                            } catch (e) {}
                        }
                    }
                }
            } catch (error) {
                addResult('üìù Generate Note', false, { error: error.message });
            }
        };

        window.testSummarize = async function() {
            const content = document.getElementById('summarizeInput').value.trim();
            if (!content) {
                addResult('üìä Summarize', false, { error: 'Please enter text to summarize' });
                return;
            }

            addResult('üìä Summarize', true, { status: 'Summarizing...' });

            try {
                const response = await fetch(`${API_BASE}/api/ai/summarize`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content: `${content}\n\n(Reply concisely)`, summary_type: 'brief' })
                });

                const data = await response.json();

                if (response.ok) {
                    addResult('üìä Summarize', true, {
                        originalLength: data.original_length,
                        summaryType: data.summary_type,
                        summary: data.summary,
                        status: 'Text summarized successfully'
                    });
                } else {
                    addResult('üìä Summarize', false, data);
                }
            } catch (error) {
                addResult('üìä Summarize', false, { error: error.message });
            }
        };

        window.testWebSummary = async function() {
            const url = document.getElementById('webUrlInput').value.trim();
            if (!url) {
                addResult('üåê Web Summary', false, { error: 'Please enter a URL' });
                return;
            }

            addResult('üåê Web Summary', true, { status: 'Fetching page...' });

            try {
                const response = await fetch(`${API_BASE}/api/web-summary/summarize`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });

                let fullResponse = '';
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.content) fullResponse += data.content;
                                if (data.finished) {
                                    addResult('üåê Web Summary', true, {
                                        url,
                                        summary: fullResponse,
                                        status: 'Web page summarized successfully'
                                    });
                                    return;
                                }
                            } catch (e) {}
                        }
                    }
                }
            } catch (error) {
                addResult('üåê Web Summary', false, { error: error.message });
            }
        };

        window.testYouTubeSummary = async function() {
            const videoUrl = document.getElementById('youtubeUrlInput').value.trim();
            const summaryType = document.getElementById('youtubeType').value;

            if (!videoUrl) {
                addResult('üé• YouTube Summary', false, { error: 'Please enter a YouTube URL' });
                return;
            }

            addResult('üé• YouTube Summary', true, { status: 'Fetching transcript...' });

            try {
                const response = await fetch(`${API_BASE}/api/youtube-summary/summarize`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ videoUrl, summaryType })
                });

                const data = await response.json();

                if (data.success) {
                    addResult('üé• YouTube Summary', true, {
                        videoId: data.videoId,
                        summaryType: data.summaryType,
                        summary: data.summary,
                        wordCount: data.transcriptWordCount,
                        duration: Math.round(data.videoDuration / 60) + ' minutes',
                        status: 'YouTube video summarized successfully'
                    });
                } else {
                    addResult('üé• YouTube Summary', false, data);
                }
            } catch (error) {
                addResult('üé• YouTube Summary', false, { error: error.message });
            }
        };

        window.testCreateWorkspace = async function() {
            const name = document.getElementById('workspaceNameInput').value.trim();
            if (!name) {
                addResult('üìÅ Create Workspace', false, { error: 'Please enter a workspace name' });
                return;
            }

            addResult('üìÅ Create Workspace', true, { status: 'Creating...' });

            try {
                const response = await fetch(`${API_BASE}/api/workspaces`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${firebaseToken}`
                    },
                    body: JSON.stringify({
                        name,
                        description: 'Created from test client',
                        icon: 'üìù',
                        color: '#667eea'
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    addResult('üìÅ Create Workspace', true, {
                        workspaceId: data.workspace.id,
                        workspaceName: data.workspace.name,
                        userId: currentUser.uid,
                        status: 'Workspace created with Firebase auth'
                    });
                } else {
                    addResult('üìÅ Create Workspace', false, data);
                }
            } catch (error) {
                addResult('üìÅ Create Workspace', false, { error: error.message });
            }
        };

        window.testGetWorkspaces = async function() {
            addResult('üìã List Workspaces', true, { status: 'Fetching...' });

            try {
                const response = await fetch(`${API_BASE}/api/workspaces`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${firebaseToken}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    addResult('üìã List Workspaces', true, {
                        count: data.workspaces.length,
                        workspaces: data.workspaces.map(w => ({
                            id: w.id,
                            name: w.name,
                            icon: w.icon
                        })),
                        status: 'Workspaces retrieved successfully'
                    });
                } else {
                    addResult('üìã List Workspaces', false, data);
                }
            } catch (error) {
                addResult('üìã List Workspaces', false, { error: error.message });
            }
        };
    </script>
</body>
</html>
